---
title: "How residence time constrains diversity"
author: "Ken Locey, Jay Lennon"
date: "May 31, 2015"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE}
rm(list=ls()) 
getwd() 
setwd("~/GitHub/hydrobide") 
```

## INTRODUCTION

Here, we explore the influence of mean cell residence time, hydraulic residence time, and particle residence time on abundance, local ($\alpha$) diversity, physiology, and resource availability and diversity.

These simulations 

```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE}
#install.packages("vegan") 
require("vegan") 
```

## Load Data

```{r, results = 'hide', message = FALSE, warning = FALSE}
sim.data <- read.csv("~/GitHub/hydrobide/results/simulated_data/2015June/June7/SimData.csv")  
```

## Univariate relationships

```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE}

simulation <- sim.data$sim
height <- sim.data$Height
width <- sim.data$Width
flow.rate <- sim.data$FlowRate

h.tau <- log((height * width)/flow.rate)
m.tau <- log(sim.data$cell.tau)
t.tau <- log(sim.data$particle.tau)

N <- sim.data$N
S <- sim.data$S
e.var <- sim.data$e.var
e.simp <- sim.data$simpson.e
avg.ab <- N/S
Skew <-sim.data$skew
Nmax <- sim.data$N.max
SimpD <- sim.data$SD
```


```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE, fig.width=5, fig.height=5}
par(mfrow=c(2, 2))

plot(h.tau, m.tau, xlab="Hydraulic Residence Time", 
     ylab="Cell Residence Time", 
     col='SteelBlue')

plot(h.tau, t.tau, xlab="Hydraulic Residence Time", 
     ylab="Particle Residence Time", 
     col='darkorchid4')

plot(t.tau, m.tau, xlab="Particle Residence Time", 
     ylab="Cell Residence Time", 
     col='darkorchid4')

```


```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE, fig.width=7, fig.height=7}
par(mfrow=c(2, 2))


plot(t.tau, N, xlab="Particle Residence Time", 
     ylab="Total Abundance", 
     main = "N vs. Tau", col='cornsilk4')

plot(m.tau, N, xlab="Cell Residence Time", 
     ylab="Total Abundance", 
     main = "N vs. Tau", col='cornsilk4')

plot(t.tau, S, xlab="Particle Residence Time", 
     ylab="Species Richness", 
     main = "S vs. Tau", col='darkseagreen')

plot(m.tau, S, xlab="Cell Residence Time", 
     ylab="Species Richness", 
     main = "S vs. Tau", col='darkseagreen')

```


```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE, fig.width=7, fig.height=7}
par(mfrow=c(2, 2))

plot(log(N), Skew, xlab="Total abundance", 
     ylab="Skewness",
     main = "Rarity vs. N",
     col='plum')

plot(log(N), log(Nmax), xlab="Total abundance", 
     ylab="Nmax", 
     main = "Nmax vs. N",
     col='darkorange')

plot(log(N), e.var, xlab="Total abundance", 
     ylab="Species Evenness", 
     main = "Evenness vs. N",
     col='lightseagreen')

plot(log(N), log(S), xlab="Total abundance",
     ylab="Species Richness", 
     main = "S vs. N",
     col='indianred')

```



```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE, fig.width=7, fig.height=7}
par(mfrow=c(2, 2))

growth <- sim.data$avg.per.capita.growth
growth <- (S*growth)/N
x <- c()
y <- c()

ct <- 1
for (val in growth){
  if(is.nan(val) == FALSE && val > 0.1){
    y <- c(y, val)
    x <- c(x, m.tau[ct])
    }
  ct <- ct+1
  }

plot(x, y, xlab="Cell Residence Time", 
     ylab="growth", 
     main = "Per capita growth vs. Tau",
     col='dodgerblue')

maint <- (S*sim.data$avg.per.capita.maint)/N
plot(m.tau, SimpD, xlab="Cell Residence Time", 
     ylab="maintenance", 
     main = "Per capita maintenance vs. Tau",
     col='darkolivegreen')

immigration <- sim.data$immigration.rate
plot(m.tau, immigration, xlab="Cell Residence Time", 
     ylab="immigration", 
     main = "Immigration vs. Tau",
     col='mediumorchid')
```



```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE, fig.width=7, fig.height=7}
par(mfrow=c(2, 2))

res.conc <- sim.data$resource.concentration
plot(m.tau, log(res.conc), xlab="Cell Residence Time", 
     ylab="density", 
     main = "Resource density vs. Tau",
     col='peru')

res.div <- sim.data$shannons.resource.diversity
plot(m.tau, res.div, xlab="Cell Residence Time", 
     ylab="Shannon's H", 
     main = "Resource diversity vs. Tau",
     col='palegreen')

res.rich <- sim.data$resource.richness
plot(m.tau, res.rich, xlab="Cell Residence Time", 
     ylab="Number of resource types", 
     main = "Resource richness vs. Tau",
     col='slateblue')
```


```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE}
rads <- list()
rad.list <- read.table("~/GitHub/hydrobide/results/simulated_data/2015June/June7/RADs.csv",
            header = FALSE, sep = ",", col.names = paste0("V", seq_len(1000)),
            as.is = TRUE, skipNul = TRUE, fill = TRUE)

rad.list[is.na(rad.list)] <- 0
```


```{r, results = 'hide', echo=FALSE, message = FALSE, warning = FALSE}
species <- list()
species.list <- read.table("~/GitHub/hydrobide/results/simulated_data/2015June/June7/Species.csv",
            header = FALSE, sep = ",", col.names = paste0("V", seq_len(1000)),
            as.is = TRUE, skipNul = TRUE, fill = TRUE)

species.list[is.na(species.list)] <- -1
```



